{"version":3,"file":"headlessui.umd.development.js","sources":["../src/hooks/use-iso-morphic-effect.ts","../src/hooks/use-id.ts","../src/hooks/use-is-initial-render.ts","../src/hooks/use-is-mounted.ts","../src/utils/match.ts","../src/utils/once.ts","../src/utils/disposables.ts","../src/components/transitions/utils/transition.ts","../src/components/transitions/transition.tsx","../src/utils/render.ts","../src/hooks/use-disposables.ts","../src/hooks/use-sync-refs.ts","../src/components/keyboard.ts","../src/components/menu/menu.tsx","../src/hooks/use-computed.ts","../src/components/listbox/listbox.tsx","../src/components/switch/switch.tsx"],"sourcesContent":["import * as React from 'react'\n\nexport const useIsoMorphicEffect =\n  typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect\n","import * as React from 'react'\nimport { useIsoMorphicEffect } from './use-iso-morphic-effect'\n\n// We used a \"simple\" approach first which worked for SSR and rehydration on the client. However we\n// didn't take care of the Suspense case. To fix this we used the approach the @reach-ui/auto-id\n// uses.\n//\n// Credits: https://github.com/reach/reach-ui/blob/develop/packages/auto-id/src/index.tsx\n\nlet state = { serverHandoffComplete: false }\nlet id = 0\nfunction generateId() {\n  return ++id\n}\n\nexport function useId() {\n  const [id, setId] = React.useState(state.serverHandoffComplete ? generateId : null)\n\n  useIsoMorphicEffect(() => {\n    if (id === null) setId(generateId())\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  React.useEffect(() => {\n    if (state.serverHandoffComplete === false) state.serverHandoffComplete = true\n  }, [])\n\n  return id != null ? '' + id : undefined\n}\n","import * as React from 'react'\n\nexport function useIsInitialRender() {\n  const initial = React.useRef(true)\n\n  React.useEffect(() => {\n    initial.current = false\n  }, [])\n\n  return initial.current\n}\n","import * as React from 'react'\n\nexport function useIsMounted() {\n  const mounted = React.useRef(true)\n\n  React.useEffect(() => {\n    return () => {\n      mounted.current = false\n    }\n  }, [])\n\n  return mounted\n}\n","export function match<TValue extends string | number = string, TReturnValue = unknown>(\n  value: TValue,\n  lookup: Record<TValue, TReturnValue | ((...args: any[]) => TReturnValue)>,\n  ...args: any[]\n): TReturnValue {\n  if (value in lookup) {\n    const returnValue = lookup[value]\n    return typeof returnValue === 'function' ? returnValue(...args) : returnValue\n  }\n\n  const error = new Error(\n    `Tried to handle \"${value}\" but there is no handler defined. Only defined handlers are: ${Object.keys(\n      lookup\n    )\n      .map(key => `\"${key}\"`)\n      .join(', ')}.`\n  )\n\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(error, match)\n  }\n\n  throw error\n}\n","export function once<T>(cb: (...args: T[]) => void) {\n  const state = { called: false }\n\n  return (...args: T[]) => {\n    if (state.called) {\n      return\n    }\n    state.called = true\n    return cb(...args)\n  }\n}\n","export function disposables() {\n  const disposables: Function[] = []\n\n  const api = {\n    requestAnimationFrame(...args: Parameters<typeof requestAnimationFrame>) {\n      const raf = requestAnimationFrame(...args)\n      api.add(() => cancelAnimationFrame(raf))\n    },\n\n    nextFrame(...args: Parameters<typeof requestAnimationFrame>) {\n      api.requestAnimationFrame(() => {\n        api.requestAnimationFrame(...args)\n      })\n    },\n\n    setTimeout(...args: Parameters<typeof setTimeout>) {\n      const timer = setTimeout(...args)\n      api.add(() => clearTimeout(timer))\n    },\n\n    add(cb: () => void) {\n      disposables.push(cb)\n    },\n\n    dispose() {\n      disposables.splice(0).forEach(dispose => dispose())\n    },\n  }\n\n  return api\n}\n","import { once } from '../../../utils/once'\nimport { disposables } from '../../../utils/disposables'\n\nfunction addClasses(node: HTMLElement, ...classes: string[]) {\n  node && classes.length > 0 && node.classList.add(...classes)\n}\n\nfunction removeClasses(node: HTMLElement, ...classes: string[]) {\n  node && classes.length > 0 && node.classList.remove(...classes)\n}\n\nexport enum Reason {\n  Finished = 'finished',\n  Cancelled = 'cancelled',\n}\n\nfunction waitForTransition(node: HTMLElement, done: (reason: Reason) => void) {\n  const d = disposables()\n\n  if (!node) return d.dispose\n\n  // Safari returns a comma separated list of values, so let's sort them and take the highest value.\n  const { transitionDuration, transitionDelay } = getComputedStyle(node)\n\n  const [durationMs, delaysMs] = [transitionDuration, transitionDelay].map(value => {\n    const [resolvedValue = 0] = value\n      .split(',')\n      // Remove falseys we can't work with\n      .filter(Boolean)\n      // Values are returned as `0.3s` or `75ms`\n      .map(v => (v.includes('ms') ? parseFloat(v) : parseFloat(v) * 1000))\n      .sort((a, z) => z - a)\n\n    return resolvedValue\n  })\n\n  // Waiting for the transition to end. We could use the `transitionend` event, however when no\n  // actual transition/duration is defined then the `transitionend` event is not fired.\n  //\n  // TODO: Downside is, when you slow down transitions via devtools this timeout is still using the\n  // full 100% speed instead of the 25% or 10%.\n  if (durationMs !== 0) {\n    d.setTimeout(() => {\n      done(Reason.Finished)\n    }, durationMs + delaysMs)\n  } else {\n    // No transition is happening, so we should cleanup already. Otherwise we have to wait until we\n    // get disposed.\n    done(Reason.Finished)\n  }\n\n  // If we get disposed before the timeout runs we should cleanup anyway\n  d.add(() => done(Reason.Cancelled))\n\n  return d.dispose\n}\n\nexport function transition(\n  node: HTMLElement,\n  base: string[],\n  from: string[],\n  to: string[],\n  done?: (reason: Reason) => void\n) {\n  const d = disposables()\n  const _done = done !== undefined ? once(done) : () => {}\n\n  addClasses(node, ...base, ...from)\n\n  d.nextFrame(() => {\n    removeClasses(node, ...from)\n    addClasses(node, ...to)\n\n    d.add(\n      waitForTransition(node, reason => {\n        removeClasses(node, ...to, ...base)\n        return _done(reason)\n      })\n    )\n  })\n\n  // Once we get disposed, we should ensure that we cleanup after ourselves. In case of an unmount,\n  // the node itself will be nullified and will be a no-op. In case of a full transition the classes\n  // are already removed which is also a no-op. However if you go from enter -> leave mid-transition\n  // then we have some leftovers that should be cleaned.\n  d.add(() => removeClasses(node, ...base, ...from, ...to))\n\n  // When we get disposed early, than we should also call the done method but switch the reason.\n  d.add(() => _done(Reason.Cancelled))\n\n  return d.dispose\n}\n","import * as React from 'react'\n\nimport { useId } from '../../hooks/use-id'\nimport { useIsInitialRender } from '../../hooks/use-is-initial-render'\nimport { useIsMounted } from '../../hooks/use-is-mounted'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\n\nimport { match } from '../../utils/match'\nimport { Reason, transition } from './utils/transition'\n\ntype ID = ReturnType<typeof useId>\n\nfunction useSplitClasses(classes: string = '') {\n  return React.useMemo(() => classes.split(' ').filter(className => className.trim().length > 1), [\n    classes,\n  ])\n}\n\ntype TransitionContextValues = {\n  show: boolean\n  appear: boolean\n} | null\nconst TransitionContext = React.createContext<TransitionContextValues>(null)\n\nenum TreeStates {\n  Visible = 'visible',\n  Hidden = 'hidden',\n}\n\nexport type TransitionClasses = Partial<{\n  enter: string\n  enterFrom: string\n  enterTo: string\n  leave: string\n  leaveFrom: string\n  leaveTo: string\n}>\n\ntype HTMLTags = keyof JSX.IntrinsicElements\ntype HTMLTagProps<TTag extends HTMLTags> = JSX.IntrinsicElements[TTag]\n\ntype AsShortcut<TTag extends HTMLTags> = {\n  children?: React.ReactNode\n  as?: TTag\n} & Omit<HTMLTagProps<TTag>, 'ref'>\n\ntype AsRenderPropFunction = {\n  children: (ref: React.MutableRefObject<any>) => JSX.Element\n}\n\ntype BaseConfig = Partial<{ appear: boolean }>\n\ntype TransitionChildProps<TTag extends HTMLTags> = BaseConfig &\n  (AsShortcut<TTag> | AsRenderPropFunction) &\n  TransitionClasses\n\nfunction useTransitionContext() {\n  const context = React.useContext(TransitionContext)\n\n  if (context === null) {\n    throw new Error('A <Transition.Child /> is used but it is missing a parent <Transition />.')\n  }\n\n  return context\n}\n\nfunction useParentNesting() {\n  const context = React.useContext(NestingContext)\n\n  if (context === null) {\n    throw new Error('A <Transition.Child /> is used but it is missing a parent <Transition />.')\n  }\n\n  return context\n}\n\ntype NestingContextValues = {\n  children: React.MutableRefObject<ID[]>\n  register: (id: ID) => () => void\n  unregister: (id: ID) => void\n}\n\nconst NestingContext = React.createContext<NestingContextValues | null>(null)\n\nfunction useNesting(done?: () => void) {\n  const doneRef = React.useRef(done)\n  const transitionableChildren = React.useRef<ID[]>([])\n  const mounted = useIsMounted()\n\n  React.useEffect(() => {\n    doneRef.current = done\n  }, [done])\n\n  const unregister = React.useCallback(\n    (childId: ID) => {\n      const idx = transitionableChildren.current.indexOf(childId)\n\n      if (idx === -1) return\n\n      transitionableChildren.current.splice(idx, 1)\n\n      if (transitionableChildren.current.length <= 0 && mounted.current) {\n        doneRef.current?.()\n      }\n    },\n    [doneRef, mounted, transitionableChildren]\n  )\n\n  const register = React.useCallback(\n    (childId: ID) => {\n      transitionableChildren.current.push(childId)\n      return () => unregister(childId)\n    },\n    [transitionableChildren, unregister]\n  )\n\n  return React.useMemo(\n    () => ({\n      children: transitionableChildren,\n      register,\n      unregister,\n    }),\n    [register, unregister, transitionableChildren]\n  )\n}\n\nfunction TransitionChild<TTag extends HTMLTags = 'div'>(props: TransitionChildProps<TTag>) {\n  const { children, enter, enterFrom, enterTo, leave, leaveFrom, leaveTo, ...rest } = props\n  const container = React.useRef<HTMLElement | null>(null)\n  const [state, setState] = React.useState(TreeStates.Visible)\n\n  const { show, appear } = useTransitionContext()\n  const { register, unregister } = useParentNesting()\n\n  const initial = useIsInitialRender()\n  const id = useId()\n\n  const isTransitioning = React.useRef(false)\n\n  const nesting = useNesting(() => {\n    // When all children have been unmounted we can only hide ourselves if and only if we are not\n    // transitioning ourserlves. Otherwise we would unmount before the transitions are finished.\n    if (!isTransitioning.current) {\n      setState(TreeStates.Hidden)\n      unregister(id)\n    }\n  })\n\n  useIsoMorphicEffect(() => {\n    if (!id) return\n    return register(id)\n  }, [register, id])\n\n  const enterClasses = useSplitClasses(enter)\n  const enterFromClasses = useSplitClasses(enterFrom)\n  const enterToClasses = useSplitClasses(enterTo)\n\n  const leaveClasses = useSplitClasses(leave)\n  const leaveFromClasses = useSplitClasses(leaveFrom)\n  const leaveToClasses = useSplitClasses(leaveTo)\n\n  React.useEffect(() => {\n    if (state === TreeStates.Visible && container.current === null) {\n      throw new Error('Did you forget to passthrough the `ref` to the actual DOM node?')\n    }\n  }, [container, state])\n\n  // Skipping initial transition\n  const skip = initial && !appear\n\n  useIsoMorphicEffect(() => {\n    const node = container.current\n    if (!node) return\n    if (skip) return\n\n    isTransitioning.current = true\n\n    return show\n      ? transition(node, enterClasses, enterFromClasses, enterToClasses, () => {\n          isTransitioning.current = false\n        })\n      : transition(node, leaveClasses, leaveFromClasses, leaveToClasses, reason => {\n          isTransitioning.current = false\n\n          if (reason !== Reason.Finished) return\n\n          // When we don't have children anymore we can safely unregister from the parent and hide\n          // ourselves.\n          if (nesting.children.current.length <= 0) {\n            setState(TreeStates.Hidden)\n            unregister(id)\n          }\n        })\n  }, [\n    id,\n    isTransitioning,\n    unregister,\n    nesting,\n    container,\n    skip,\n    show,\n    enterClasses,\n    enterFromClasses,\n    enterToClasses,\n    leaveClasses,\n    leaveFromClasses,\n    leaveToClasses,\n  ])\n\n  // Unmount the whole tree\n  if (state === TreeStates.Hidden) return null\n\n  if (typeof children === 'function') {\n    return (\n      <NestingContext.Provider value={nesting}>\n        {(children as AsRenderPropFunction['children'])(container)}\n      </NestingContext.Provider>\n    )\n  }\n\n  const { as: Component = 'div', ...passthroughProps } = rest as AsShortcut<TTag>\n  return (\n    <NestingContext.Provider value={nesting}>\n      {/* @ts-expect-error Expression produces a union type that is too complex to represent. */}\n      <Component {...passthroughProps} ref={container}>\n        {children}\n      </Component>\n    </NestingContext.Provider>\n  )\n}\n\nexport function Transition<TTag extends HTMLTags = 'div'>(\n  props: TransitionChildProps<TTag> & { show: boolean; appear?: boolean }\n) {\n  const { show, appear = false, ...rest } = props\n\n  if (![true, false].includes(show)) {\n    throw new Error('A <Transition /> is used but it is missing a `show={true | false}` prop.')\n  }\n\n  const [state, setState] = React.useState(show ? TreeStates.Visible : TreeStates.Hidden)\n\n  const nestingBag = useNesting(() => {\n    setState(TreeStates.Hidden)\n  })\n\n  const initial = useIsInitialRender()\n  const transitionBag = React.useMemo<TransitionContextValues>(\n    () => ({ show, appear: appear || !initial }),\n    [show, appear, initial]\n  )\n\n  React.useEffect(() => {\n    if (show) {\n      setState(TreeStates.Visible)\n    } else if (nestingBag.children.current.length <= 0) {\n      setState(TreeStates.Hidden)\n    }\n  }, [show, nestingBag])\n\n  return (\n    <NestingContext.Provider value={nestingBag}>\n      <TransitionContext.Provider value={transitionBag}>\n        {match(state, {\n          [TreeStates.Visible]: () => <TransitionChild {...rest} />,\n          [TreeStates.Hidden]: null,\n        })}\n      </TransitionContext.Provider>\n    </NestingContext.Provider>\n  )\n}\n\nTransition.Child = TransitionChild\n","import * as React from 'react'\nimport { Props } from '../types'\n\nexport function render<TTag extends React.ElementType, TBag>(\n  props: Props<TTag, TBag, any>,\n  bag: TBag,\n  tag: React.ElementType\n) {\n  const { as: Component = tag, children, ...passThroughProps } = props\n\n  const resolvedChildren = (typeof children === 'function' ? children(bag) : children) as\n    | React.ReactElement\n    | React.ReactElement[]\n\n  if (Component === React.Fragment) {\n    if (Object.keys(passThroughProps).length > 0) {\n      if (Array.isArray(resolvedChildren) && resolvedChildren.length > 1) {\n        const err = new Error('You should only render 1 child')\n        if (Error.captureStackTrace) Error.captureStackTrace(err, render)\n        throw err\n      }\n\n      if (!React.isValidElement(resolvedChildren)) {\n        const err = new Error(\n          `You should render an element as a child. Did you forget the as=\"...\" prop?`\n        )\n        if (Error.captureStackTrace) Error.captureStackTrace(err, render)\n        throw err\n      }\n\n      return React.cloneElement(\n        resolvedChildren,\n\n        // Filter out undefined values so that they don't override the existing values\n        mergeEventFunctions(compact(passThroughProps), resolvedChildren.props, ['onClick'])\n      )\n    }\n  }\n\n  return React.createElement(Component, passThroughProps, resolvedChildren)\n}\n\n/**\n * We can use this function for the following useCase:\n *\n * <Menu.Item> <button onClick={console.log} /> </Menu.Item>\n *\n * Our `Menu.Item` will have an internal `onClick`, if you passthrough an `onClick` to the actual\n * `Menu.Item` component we will call it correctly. However, when we have an `onClick` on the actual\n * first child, that one should _also_ be called (but before this implementation, it was just\n * overriding the `onClick`). But it is only when we *render* that we have access to the existing\n * props of this component.\n *\n * It's a bit hacky, and not that clean, but it is something internal and we have tests to rely on\n * so that we can refactor this later (if needed).\n */\nfunction mergeEventFunctions(\n  passThroughProps: Record<string, any>,\n  existingProps: Record<string, any>,\n  functionsToMerge: string[]\n) {\n  let clone = Object.assign({}, passThroughProps)\n  for (let func of functionsToMerge) {\n    if (passThroughProps[func] !== undefined && existingProps[func] !== undefined) {\n      Object.assign(clone, {\n        [func](event: { defaultPrevented: boolean }) {\n          // Props we control\n          if (!event.defaultPrevented) passThroughProps[func](event)\n\n          // Existing props on the component\n          if (!event.defaultPrevented) existingProps[func](event)\n        },\n      })\n    }\n  }\n\n  return clone\n}\n\n/**\n * This is a hack, but basically we want to keep the full 'API' of the component, but we do want to\n * wrap it in a forwardRef so that we _can_ passthrough the ref\n */\nexport function forwardRefWithAs<T>(component: T): T {\n  return React.forwardRef((component as unknown) as any) as any\n}\n\nfunction compact<T extends Record<any, any>>(object: T) {\n  let clone = Object.assign({}, object)\n  for (let key in clone) {\n    if (clone[key] === undefined) delete clone[key]\n  }\n  return clone\n}\n","import * as React from 'react'\n\nimport { disposables } from '../utils/disposables'\n\nexport function useDisposables() {\n  // Using useState instead of useRef so that we can use the initializer function.\n  const [d] = React.useState(disposables)\n  React.useEffect(() => () => d.dispose(), [d])\n  return d\n}\n","import * as React from 'react'\n\nexport function useSyncRefs<TType>(\n  ...refs: (React.MutableRefObject<TType> | ((instance: TType) => void) | null)[]\n) {\n  return React.useCallback(\n    (value: TType) => {\n      refs.forEach(ref => {\n        if (ref === null) return\n        if (typeof ref === 'function') return ref(value)\n        ref.current = value\n      })\n    },\n    [refs]\n  )\n}\n","// TODO: This must already exist somewhere, right? ðŸ¤”\n// Ref: https://www.w3.org/TR/uievents-key/#named-key-attribute-values\nexport enum Keys {\n  Space = ' ',\n  Enter = 'Enter',\n  Escape = 'Escape',\n  Backspace = 'Backspace',\n\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n\n  Home = 'Home',\n  End = 'End',\n\n  PageUp = 'PageUp',\n  PageDown = 'PageDown',\n\n  Tab = 'Tab',\n}\n","// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\nimport * as React from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render } from '../../utils/render'\nimport { disposables } from '../../utils/disposables'\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\n\nenum MenuStates {\n  Open,\n  Closed,\n}\n\ntype MenuItemDataRef = React.MutableRefObject<{ textValue?: string; disabled: boolean }>\n\ntype StateDefinition = {\n  menuState: MenuStates\n  buttonRef: React.MutableRefObject<HTMLButtonElement | null>\n  itemsRef: React.MutableRefObject<HTMLDivElement | null>\n  items: { id: string; dataRef: MenuItemDataRef }[]\n  searchQuery: string\n  activeItemIndex: number | null\n}\n\nenum ActionTypes {\n  OpenMenu,\n  CloseMenu,\n\n  GoToItem,\n  Search,\n  ClearSearch,\n\n  RegisterItem,\n  UnregisterItem,\n}\n\nenum Focus {\n  FirstItem,\n  PreviousItem,\n  NextItem,\n  LastItem,\n  SpecificItem,\n  Nothing,\n}\n\nfunction calculateActiveItemIndex(\n  state: StateDefinition,\n  focus: Focus,\n  id?: string\n): StateDefinition['activeItemIndex'] {\n  if (state.items.length <= 0) return null\n\n  const items = state.items\n  const activeItemIndex = state.activeItemIndex ?? -1\n\n  const nextActiveIndex = match(focus, {\n    [Focus.FirstItem]: () => items.findIndex(item => !item.dataRef.current.disabled),\n    [Focus.PreviousItem]: () => {\n      const idx = items\n        .slice()\n        .reverse()\n        .findIndex((item, idx, all) => {\n          if (activeItemIndex !== -1 && all.length - idx - 1 >= activeItemIndex) return false\n          return !item.dataRef.current.disabled\n        })\n      if (idx === -1) return idx\n      return items.length - 1 - idx\n    },\n    [Focus.NextItem]: () => {\n      return items.findIndex((item, idx) => {\n        if (idx <= activeItemIndex) return false\n        return !item.dataRef.current.disabled\n      })\n    },\n    [Focus.LastItem]: () => {\n      const idx = items\n        .slice()\n        .reverse()\n        .findIndex(item => !item.dataRef.current.disabled)\n      if (idx === -1) return idx\n      return items.length - 1 - idx\n    },\n    [Focus.SpecificItem]: () => items.findIndex(item => item.id === id),\n    [Focus.Nothing]: () => null,\n  })\n\n  if (nextActiveIndex === -1) return state.activeItemIndex\n  return nextActiveIndex\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseMenu }\n  | { type: ActionTypes.OpenMenu }\n  | { type: ActionTypes.GoToItem; focus: Focus; id?: string }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterItem; id: string; dataRef: MenuItemDataRef }\n  | { type: ActionTypes.UnregisterItem; id: string }\n\nconst reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseMenu]: state => ({ ...state, menuState: MenuStates.Closed }),\n  [ActionTypes.OpenMenu]: state => ({ ...state, menuState: MenuStates.Open }),\n  [ActionTypes.GoToItem]: (state, action) => {\n    const activeItemIndex = calculateActiveItemIndex(state, action.focus, action.id)\n\n    if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) {\n      return state\n    }\n\n    return {\n      ...state,\n      searchQuery: '',\n      activeItemIndex,\n    }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    const searchQuery = state.searchQuery + action.value\n    const match = state.items.findIndex(\n      item =>\n        item.dataRef.current.textValue?.startsWith(searchQuery) && !item.dataRef.current.disabled\n    )\n\n    if (match === -1 || match === state.activeItemIndex) {\n      return { ...state, searchQuery }\n    }\n\n    return {\n      ...state,\n      searchQuery,\n      activeItemIndex: match,\n    }\n  },\n  [ActionTypes.ClearSearch]: state => ({ ...state, searchQuery: '' }),\n  [ActionTypes.RegisterItem]: (state, action) => ({\n    ...state,\n    items: [...state.items, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterItem]: (state, action) => {\n    const nextItems = state.items.slice()\n    const currentActiveItem =\n      state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null\n\n    const idx = nextItems.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextItems.splice(idx, 1)\n\n    return {\n      ...state,\n      items: nextItems,\n      activeItemIndex: (() => {\n        if (idx === state.activeItemIndex) return null\n        if (currentActiveItem === null) return null\n\n        // If we removed the item before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextItems.indexOf(currentActiveItem)\n      })(),\n    }\n  },\n}\n\nconst MenuContext = React.createContext<[StateDefinition, React.Dispatch<Actions>] | null>(null)\n\nfunction useMenuContext(component: string) {\n  const context = React.useContext(MenuContext)\n  if (context === null) {\n    const err = new Error(`<${component} /> is missing a parent <${Menu.name} /> component.`)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(err, useMenuContext)\n    }\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nconst DEFAULT_MENU_TAG = React.Fragment\n\ntype MenuRenderPropArg = { open: boolean }\n\nexport function Menu<TTag extends React.ElementType = typeof DEFAULT_MENU_TAG>(\n  props: Props<TTag, MenuRenderPropArg>\n) {\n  const d = useDisposables()\n  const reducerBag = React.useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: React.createRef(),\n    itemsRef: React.createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null,\n  } as StateDefinition)\n  const [{ menuState, itemsRef, buttonRef }, dispatch] = reducerBag\n\n  React.useEffect(() => {\n    function handler(event: MouseEvent) {\n      if (menuState !== MenuStates.Open) return\n      if (buttonRef.current?.contains(event.target as HTMLElement)) return\n\n      if (!itemsRef.current?.contains(event.target as HTMLElement)) {\n        dispatch({ type: ActionTypes.CloseMenu })\n      }\n      if (!event.defaultPrevented) d.nextFrame(() => buttonRef.current?.focus())\n    }\n\n    window.addEventListener('click', handler)\n    return () => window.removeEventListener('click', handler)\n  }, [menuState, itemsRef, buttonRef, d, dispatch])\n\n  const propsBag = React.useMemo(() => ({ open: menuState === MenuStates.Open }), [menuState])\n\n  return (\n    <MenuContext.Provider value={reducerBag}>\n      {render(props, propsBag, DEFAULT_MENU_TAG)}\n    </MenuContext.Provider>\n  )\n}\n\n// ---\n\ntype ButtonPropsWeControl =\n  | 'ref'\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'onKeyDown'\n  | 'onFocus'\n  | 'onBlur'\n  | 'onPointerUp'\n\nconst DEFAULT_BUTTON_TAG = 'button'\n\ntype ButtonRenderPropArg = { open: boolean; focused: boolean }\n\nconst Button = forwardRefWithAs(function Button<\n  TTag extends React.ElementType = typeof DEFAULT_BUTTON_TAG\n>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: React.Ref<HTMLButtonElement>\n) {\n  const [state, dispatch] = useMenuContext([Menu.name, Button.name].join('.'))\n  const buttonRef = useSyncRefs(state.buttonRef, ref)\n  const [focused, setFocused] = React.useState(false)\n\n  const id = `headlessui-menu-button-${useId()}`\n  const d = useDisposables()\n\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => {\n            state.itemsRef.current?.focus()\n            dispatch({ type: ActionTypes.GoToItem, focus: Focus.FirstItem })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => {\n            state.itemsRef.current?.focus()\n            dispatch({ type: ActionTypes.GoToItem, focus: Focus.LastItem })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  const handlePointerUp = React.useCallback(\n    (event: MouseEvent) => {\n      if (state.menuState === MenuStates.Open) {\n        dispatch({ type: ActionTypes.CloseMenu })\n        d.nextFrame(() => state.buttonRef.current?.focus())\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenMenu })\n        d.nextFrame(() => state.itemsRef.current?.focus())\n      }\n    },\n    [dispatch, d, state]\n  )\n\n  const handleFocus = React.useCallback(() => {\n    if (state.menuState === MenuStates.Open) state.itemsRef.current?.focus()\n    setFocused(true)\n  }, [state, setFocused])\n\n  const handleBlur = React.useCallback(() => setFocused(false), [setFocused])\n\n  const propsBag = React.useMemo(() => ({ open: state.menuState === MenuStates.Open, focused }), [\n    state,\n    focused,\n  ])\n  const passthroughProps = props\n  const propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: 'button',\n    'aria-haspopup': true,\n    'aria-controls': state.itemsRef.current?.id,\n    'aria-expanded': state.menuState === MenuStates.Open ? true : undefined,\n    onKeyDown: handleKeyDown,\n    onFocus: handleFocus,\n    onBlur: handleBlur,\n    onPointerUp: handlePointerUp,\n  }\n\n  return render({ ...passthroughProps, ...propsWeControl }, propsBag, DEFAULT_BUTTON_TAG)\n})\n\n// ---\n\ntype ItemsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'ref'\n  | 'role'\n  | 'tabIndex'\n\nconst DEFAULT_ITEMS_TAG = 'div'\n\ntype ItemsRenderPropArg = { open: boolean }\n\nconst Items = forwardRefWithAs(function Items<\n  TTag extends React.ElementType = typeof DEFAULT_ITEMS_TAG\n>(\n  props: Props<TTag, ItemsRenderPropArg, ItemsPropsWeControl> & { static?: boolean },\n  ref: React.Ref<HTMLDivElement>\n) {\n  const { static: isStatic = false, ...passthroughProps } = props\n  const [state, dispatch] = useMenuContext([Menu.name, Items.name].join('.'))\n  const itemsRef = useSyncRefs(state.itemsRef, ref)\n\n  const id = `headlessui-menu-items-${useId()}`\n  const searchDisposables = useDisposables()\n\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLDivElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseMenu })\n          if (state.activeItemIndex !== null) {\n            const { id } = state.items[state.activeItemIndex]\n            document.getElementById(id)?.click()\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus())\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.NextItem })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.PreviousItem })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.FirstItem })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.LastItem })\n\n        case Keys.Escape:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseMenu })\n          disposables().nextFrame(() => state.buttonRef.current?.focus())\n          break\n\n        case Keys.Tab:\n          return event.preventDefault()\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [dispatch, searchDisposables, state]\n  )\n\n  const propsBag = React.useMemo(() => ({ open: state.menuState === MenuStates.Open }), [state])\n  const propsWeControl = {\n    'aria-activedescendant':\n      state.activeItemIndex === null ? undefined : state.items[state.activeItemIndex]?.id,\n    'aria-labelledby': state.buttonRef.current?.id,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'menu',\n    tabIndex: 0,\n  }\n\n  if (!isStatic && state.menuState === MenuStates.Closed) return null\n\n  return render(\n    { ...passthroughProps, ...propsWeControl, ...{ ref: itemsRef } },\n    propsBag,\n    DEFAULT_ITEMS_TAG\n  )\n})\n\n// ---\n\ntype MenuItemPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'onPointerLeave'\n  | 'onFocus'\n\nconst DEFAULT_ITEM_TAG = React.Fragment\n\ntype ItemRenderPropArg = { active: boolean; disabled: boolean }\n\nfunction Item<TTag extends React.ElementType = typeof DEFAULT_ITEM_TAG>(\n  props: Props<TTag, ItemRenderPropArg, MenuItemPropsWeControl | 'className'> & {\n    disabled?: boolean\n    onClick?: (event: { preventDefault: Function }) => void\n\n    // Special treatment, can either be a string or a function that resolves to a string\n    className?: ((bag: ItemRenderPropArg) => string) | string\n  }\n) {\n  const { disabled = false, className, onClick, ...passthroughProps } = props\n  const [state, dispatch] = useMenuContext([Menu.name, Item.name].join('.'))\n  const d = useDisposables()\n  const id = `headlessui-menu-item-${useId()}`\n  const active =\n    state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false\n\n  const bag = React.useRef<MenuItemDataRef['current']>({ disabled })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterItem, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterItem, id })\n  }, [bag, id])\n\n  const handleClick = React.useCallback(\n    (event: { preventDefault: Function }) => {\n      if (disabled) return event.preventDefault()\n      dispatch({ type: ActionTypes.CloseMenu })\n      d.nextFrame(() => state.buttonRef.current?.focus())\n      if (onClick) return onClick(event)\n    },\n    [d, dispatch, state.buttonRef, disabled, onClick]\n  )\n\n  const handleFocus = React.useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.SpecificItem, id })\n  }, [disabled, id, dispatch])\n\n  const handlePointerMove = React.useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.SpecificItem, id })\n  }, [disabled, active, id, dispatch])\n\n  const handlePointerLeave = React.useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  const propsBag = React.useMemo(() => ({ active, disabled }), [active, disabled])\n  const propsWeControl = {\n    id,\n    role: 'menuitem',\n    tabIndex: -1,\n    className: resolvePropValue(className, propsBag),\n    'aria-disabled': disabled === true ? true : undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handlePointerMove,\n    onPointerLeave: handlePointerLeave,\n  }\n\n  return render<TTag, ItemRenderPropArg>(\n    { ...passthroughProps, ...propsWeControl },\n    propsBag,\n    DEFAULT_ITEM_TAG\n  )\n}\n\nfunction resolvePropValue<TProperty, TBag>(property: TProperty, bag: TBag) {\n  if (property === undefined) return undefined\n  if (typeof property === 'function') return property(bag)\n  return property\n}\n\n// ---\n\nMenu.Button = Button\nMenu.Items = Items\nMenu.Item = Item\n","import * as React from 'react'\nimport { useIsoMorphicEffect } from './use-iso-morphic-effect'\n\nexport function useComputed<T>(cb: () => T, dependencies: React.DependencyList) {\n  const [value, setValue] = React.useState(cb)\n  const cbRef = React.useRef(cb)\n  useIsoMorphicEffect(() => {\n    cbRef.current = cb\n  }, [cb])\n  useIsoMorphicEffect(() => setValue(cbRef.current), [cbRef, setValue, ...dependencies])\n  return value\n}\n","import * as React from 'react'\n\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useId } from '../../hooks/use-id'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useComputed } from '../../hooks/use-computed'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { Props } from '../../types'\nimport { forwardRefWithAs, render } from '../../utils/render'\nimport { match } from '../../utils/match'\nimport { disposables } from '../../utils/disposables'\nimport { Keys } from '../keyboard'\n\nenum ListboxStates {\n  Open,\n  Closed,\n}\n\ntype ListboxOptionDataRef = React.MutableRefObject<{\n  textValue?: string\n  disabled: boolean\n  value: unknown\n}>\n\ntype StateDefinition = {\n  listboxState: ListboxStates\n  propsRef: React.MutableRefObject<{ value: unknown; onChange(value: unknown): void }>\n  labelRef: React.MutableRefObject<HTMLLabelElement | null>\n  buttonRef: React.MutableRefObject<HTMLButtonElement | null>\n  optionsRef: React.MutableRefObject<HTMLUListElement | null>\n  options: { id: string; dataRef: ListboxOptionDataRef }[]\n  searchQuery: string\n  activeOptionIndex: number | null\n}\n\nenum ActionTypes {\n  OpenListbox,\n  CloseListbox,\n\n  GoToOption,\n  Search,\n  ClearSearch,\n\n  RegisterOption,\n  UnregisterOption,\n}\n\nenum Focus {\n  First,\n  Previous,\n  Next,\n  Last,\n  Specific,\n  Nothing,\n}\n\nfunction calculateActiveOptionIndex(\n  state: StateDefinition,\n  focus: Focus,\n  id?: string\n): StateDefinition['activeOptionIndex'] {\n  if (state.options.length <= 0) return null\n\n  const options = state.options\n  const activeOptionIndex = state.activeOptionIndex ?? -1\n\n  const nextActiveIndex = match(focus, {\n    [Focus.First]: () => options.findIndex(option => !option.dataRef.current.disabled),\n    [Focus.Previous]: () => {\n      const idx = options\n        .slice()\n        .reverse()\n        .findIndex((option, idx, all) => {\n          if (activeOptionIndex !== -1 && all.length - idx - 1 >= activeOptionIndex) return false\n          return !option.dataRef.current.disabled\n        })\n      if (idx === -1) return idx\n      return options.length - 1 - idx\n    },\n    [Focus.Next]: () => {\n      return options.findIndex((option, idx) => {\n        if (idx <= activeOptionIndex) return false\n        return !option.dataRef.current.disabled\n      })\n    },\n    [Focus.Last]: () => {\n      const idx = options\n        .slice()\n        .reverse()\n        .findIndex(option => !option.dataRef.current.disabled)\n      if (idx === -1) return idx\n      return options.length - 1 - idx\n    },\n    [Focus.Specific]: () => options.findIndex(option => option.id === id),\n    [Focus.Nothing]: () => null,\n  })\n\n  if (nextActiveIndex === -1) return state.activeOptionIndex\n  return nextActiveIndex\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseListbox }\n  | { type: ActionTypes.OpenListbox }\n  | { type: ActionTypes.GoToOption; focus: Focus; id?: string }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterOption; id: string; dataRef: ListboxOptionDataRef }\n  | { type: ActionTypes.UnregisterOption; id: string }\n\nconst reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseListbox]: state => ({ ...state, listboxState: ListboxStates.Closed }),\n  [ActionTypes.OpenListbox]: state => ({ ...state, listboxState: ListboxStates.Open }),\n  [ActionTypes.GoToOption]: (state, action) => {\n    const activeOptionIndex = calculateActiveOptionIndex(state, action.focus, action.id)\n\n    if (state.searchQuery === '' && state.activeOptionIndex === activeOptionIndex) {\n      return state\n    }\n\n    return { ...state, searchQuery: '', activeOptionIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    const searchQuery = state.searchQuery + action.value\n    const match = state.options.findIndex(\n      option =>\n        !option.dataRef.current.disabled &&\n        option.dataRef.current.textValue?.startsWith(searchQuery)\n    )\n\n    if (match === -1 || match === state.activeOptionIndex) {\n      return { ...state, searchQuery }\n    }\n\n    return { ...state, searchQuery, activeOptionIndex: match }\n  },\n  [ActionTypes.ClearSearch]: state => ({ ...state, searchQuery: '' }),\n  [ActionTypes.RegisterOption]: (state, action) => ({\n    ...state,\n    options: [...state.options, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterOption]: (state, action) => {\n    const nextOptions = state.options.slice()\n    const currentActiveOption =\n      state.activeOptionIndex !== null ? nextOptions[state.activeOptionIndex] : null\n\n    const idx = nextOptions.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextOptions.splice(idx, 1)\n\n    return {\n      ...state,\n      options: nextOptions,\n      activeOptionIndex: (() => {\n        if (idx === state.activeOptionIndex) return null\n        if (currentActiveOption === null) return null\n\n        // If we removed the option before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextOptions.indexOf(currentActiveOption)\n      })(),\n    }\n  },\n}\n\nconst ListboxContext = React.createContext<[StateDefinition, React.Dispatch<Actions>] | null>(null)\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\nfunction useListboxContext(component: string) {\n  const context = React.useContext(ListboxContext)\n  if (context === null) {\n    const err = new Error(`<${component} /> is missing a parent <${Listbox.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext)\n    throw err\n  }\n  return context\n}\n\n// ---\n\nconst DEFAULT_LISTBOX_TAG = React.Fragment\n\ntype ListboxRenderPropArg = { open: boolean }\n\nexport function Listbox<\n  TTag extends React.ElementType = typeof DEFAULT_LISTBOX_TAG,\n  TType = string\n>(props: Props<TTag, ListboxRenderPropArg> & { value: TType; onChange(value: TType): void }) {\n  const { value, onChange, ...passThroughProps } = props\n  const d = useDisposables()\n  const reducerBag = React.useReducer(stateReducer, {\n    listboxState: ListboxStates.Closed,\n    propsRef: { current: { value, onChange } },\n    labelRef: React.createRef(),\n    buttonRef: React.createRef(),\n    optionsRef: React.createRef(),\n    options: [],\n    searchQuery: '',\n    activeOptionIndex: null,\n  } as StateDefinition)\n  const [{ listboxState, propsRef, optionsRef, buttonRef }, dispatch] = reducerBag\n\n  useIsoMorphicEffect(() => {\n    propsRef.current.value = value\n  }, [value, propsRef])\n  useIsoMorphicEffect(() => {\n    propsRef.current.onChange = onChange\n  }, [onChange, propsRef])\n\n  React.useEffect(() => {\n    function handler(event: MouseEvent) {\n      if (listboxState !== ListboxStates.Open) return\n      if (buttonRef.current?.contains(event.target as HTMLElement)) return\n\n      if (!optionsRef.current?.contains(event.target as HTMLElement)) {\n        dispatch({ type: ActionTypes.CloseListbox })\n      }\n      if (!event.defaultPrevented) d.nextFrame(() => buttonRef.current?.focus())\n    }\n\n    window.addEventListener('click', handler)\n    return () => window.removeEventListener('click', handler)\n  }, [listboxState, optionsRef, buttonRef, d, dispatch])\n\n  const propsBag = React.useMemo<ListboxRenderPropArg>(\n    () => ({ open: listboxState === ListboxStates.Open }),\n    [listboxState]\n  )\n\n  return (\n    <ListboxContext.Provider value={reducerBag}>\n      {render(passThroughProps, propsBag, DEFAULT_LISTBOX_TAG)}\n    </ListboxContext.Provider>\n  )\n}\n\n// ---\n\ntype ButtonPropsWeControl =\n  | 'ref'\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'aria-labelledby'\n  | 'onKeyDown'\n  | 'onFocus'\n  | 'onBlur'\n  | 'onPointerUp'\n\nconst DEFAULT_BUTTON_TAG = 'button'\n\ntype ButtonRenderPropArg = { open: boolean; focused: boolean }\n\nconst Button = forwardRefWithAs(function Button<\n  TTag extends React.ElementType = typeof DEFAULT_BUTTON_TAG\n>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: React.Ref<HTMLButtonElement>\n) {\n  const [state, dispatch] = useListboxContext([Listbox.name, Button.name].join('.'))\n  const buttonRef = useSyncRefs(state.buttonRef, ref)\n  const [focused, setFocused] = React.useState(false)\n\n  const id = `headlessui-listbox-button-${useId()}`\n  const d = useDisposables()\n\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            state.optionsRef.current?.focus()\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            state.optionsRef.current?.focus()\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  const handlePointerUp = React.useCallback(\n    (event: MouseEvent) => {\n      if (state.listboxState === ListboxStates.Open) {\n        dispatch({ type: ActionTypes.CloseListbox })\n        d.nextFrame(() => state.buttonRef.current?.focus())\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenListbox })\n        d.nextFrame(() => state.optionsRef.current?.focus())\n      }\n    },\n    [dispatch, d, state]\n  )\n\n  const handleFocus = React.useCallback(() => {\n    if (state.listboxState === ListboxStates.Open) return state.optionsRef.current?.focus()\n    setFocused(true)\n  }, [state, setFocused])\n\n  const handleBlur = React.useCallback(() => setFocused(false), [setFocused])\n  const labelledby = useComputed(() => {\n    if (!state.labelRef.current) return undefined\n    return [state.labelRef.current.id, id].join(' ')\n  }, [state.labelRef.current, id])\n\n  const propsBag = React.useMemo<ButtonRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, focused }),\n    [state, focused]\n  )\n  const passthroughProps = props\n  const propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: 'button',\n    'aria-haspopup': true,\n    'aria-controls': state.optionsRef.current?.id,\n    'aria-expanded': state.listboxState === ListboxStates.Open ? true : undefined,\n    'aria-labelledby': labelledby,\n    onKeyDown: handleKeyDown,\n    onFocus: handleFocus,\n    onBlur: handleBlur,\n    onPointerUp: handlePointerUp,\n  }\n\n  return render({ ...passthroughProps, ...propsWeControl }, propsBag, DEFAULT_BUTTON_TAG)\n})\n\n// ---\n\ntype LabelPropsWeControl = 'id' | 'ref' | 'onPointerUp'\n\nconst DEFAULT_LABEL_TAG = 'label'\n\ntype LabelRenderPropArg = { open: boolean }\n\nfunction Label<TTag extends React.ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  const [state] = useListboxContext([Listbox.name, Label.name].join('.'))\n  const id = `headlessui-listbox-label-${useId()}`\n\n  const handlePointerUp = React.useCallback(() => state.buttonRef.current?.focus(), [\n    state.buttonRef,\n  ])\n\n  const propsBag = React.useMemo<OptionsRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open }),\n    [state]\n  )\n  const propsWeControl = {\n    ref: state.labelRef,\n    id,\n    onPointerUp: handlePointerUp,\n  }\n  return render({ ...props, ...propsWeControl }, propsBag, DEFAULT_LABEL_TAG)\n}\n\n// ---\n\ntype OptionsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'ref'\n  | 'role'\n  | 'tabIndex'\n\nconst DEFAULT_OPTIONS_TAG = 'ul'\n\ntype OptionsRenderPropArg = { open: boolean }\n\ntype ListboxOptionsProp<TTag> = Props<TTag, OptionsRenderPropArg, OptionsPropsWeControl> & {\n  static?: boolean\n}\n\nconst Options = forwardRefWithAs(function Options<\n  TTag extends React.ElementType = typeof DEFAULT_OPTIONS_TAG\n>(props: ListboxOptionsProp<TTag>, ref: React.Ref<HTMLUListElement>) {\n  const {\n    enter,\n    enterFrom,\n    enterTo,\n    leave,\n    leaveFrom,\n    leaveTo,\n    static: isStatic = false,\n    ...passthroughProps\n  } = props\n  const [state, dispatch] = useListboxContext([Listbox.name, Options.name].join('.'))\n  const optionsRef = useSyncRefs(state.optionsRef, ref)\n\n  const id = `headlessui-listbox-options-${useId()}`\n  const d = useDisposables()\n  const searchDisposables = useDisposables()\n\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLUListElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseListbox })\n          if (state.activeOptionIndex !== null) {\n            const { dataRef } = state.options[state.activeOptionIndex]\n            state.propsRef.current.onChange(dataRef.current.value)\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus())\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseListbox })\n          return d.nextFrame(() => state.buttonRef.current?.focus())\n\n        case Keys.Tab:\n          return event.preventDefault()\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [d, dispatch, searchDisposables, state]\n  )\n\n  const labelledby = useComputed(() => state.labelRef.current?.id ?? state.buttonRef.current?.id, [\n    state.labelRef.current,\n    state.buttonRef.current,\n  ])\n\n  const propsBag = React.useMemo<OptionsRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open }),\n    [state]\n  )\n  const propsWeControl = {\n    'aria-activedescendant':\n      state.activeOptionIndex === null ? undefined : state.options[state.activeOptionIndex]?.id,\n    'aria-labelledby': labelledby,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'listbox',\n    tabIndex: 0,\n  }\n\n  if (!isStatic && state.listboxState === ListboxStates.Closed) return null\n\n  return render(\n    { ...passthroughProps, ...propsWeControl, ...{ ref: optionsRef } },\n    propsBag,\n    DEFAULT_OPTIONS_TAG\n  )\n})\n\n// ---\n\ntype ListboxOptionPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'aria-selected'\n  | 'onPointerLeave'\n  | 'onFocus'\n\nconst DEFAULT_OPTION_TAG = 'li'\n\ntype OptionRenderPropArg = { active: boolean; selected: boolean; disabled: boolean }\n\nfunction Option<TTag extends React.ElementType = typeof DEFAULT_OPTION_TAG, TType = string>(\n  props: Props<TTag, OptionRenderPropArg, ListboxOptionPropsWeControl | 'className'> & {\n    disabled?: boolean\n    value: TType\n\n    // Special treatment, can either be a string or a function that resolves to a string\n    className?: ((bag: OptionRenderPropArg) => string) | string\n  }\n) {\n  const { disabled = false, value, className, ...passthroughProps } = props\n  const [state, dispatch] = useListboxContext([Listbox.name, Option.name].join('.'))\n  const id = `headlessui-listbox-option-${useId()}`\n  const active =\n    state.activeOptionIndex !== null ? state.options[state.activeOptionIndex].id === id : false\n  const selected = state.propsRef.current.value === value\n\n  const bag = React.useRef<ListboxOptionDataRef['current']>({ disabled, value })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n  useIsoMorphicEffect(() => {\n    bag.current.value = value\n  }, [bag, value])\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  const select = React.useCallback(() => state.propsRef.current.onChange(value), [\n    state.propsRef,\n    value,\n  ])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterOption, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterOption, id })\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    if (!selected) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n    document.getElementById(id)?.focus?.()\n  }, [])\n\n  useIsoMorphicEffect(() => {\n    if (!active) return\n    const d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [active])\n\n  const handleClick = React.useCallback(\n    (event: { preventDefault: Function }) => {\n      if (disabled) return event.preventDefault()\n      select()\n      dispatch({ type: ActionTypes.CloseListbox })\n      disposables().nextFrame(() => state.buttonRef.current?.focus())\n    },\n    [dispatch, state.buttonRef, disabled, select]\n  )\n\n  const handleFocus = React.useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  const handlePointerMove = React.useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  const handlePointerLeave = React.useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  const propsBag = React.useMemo(() => ({ active, selected, disabled }), [\n    active,\n    selected,\n    disabled,\n  ])\n  const propsWeControl = {\n    id,\n    role: 'option',\n    tabIndex: -1,\n    className: resolvePropValue(className, propsBag),\n    'aria-disabled': disabled === true ? true : undefined,\n    'aria-selected': selected === true ? true : undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handlePointerMove,\n    onPointerLeave: handlePointerLeave,\n  }\n\n  return render<TTag, OptionRenderPropArg>(\n    { ...passthroughProps, ...propsWeControl },\n    propsBag,\n    DEFAULT_OPTION_TAG\n  )\n}\n\nfunction resolvePropValue<TProperty, TBag>(property: TProperty, bag: TBag) {\n  if (property === undefined) return undefined\n  if (typeof property === 'function') return property(bag)\n  return property\n}\n\n// ---\n\nListbox.Button = Button\nListbox.Label = Label\nListbox.Options = Options\nListbox.Option = Option\n","import * as React from 'react'\n\nimport { Props } from '../../types'\nimport { render } from '../../utils/render'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\n\ntype StateDefinition = {\n  switch: HTMLButtonElement | null\n  label: HTMLLabelElement | null\n\n  setSwitch(element: HTMLButtonElement): void\n  setLabel(element: HTMLLabelElement): void\n}\n\nconst GroupContext = React.createContext<StateDefinition | null>(null)\n\nfunction useGroupContext(component: string) {\n  const context = React.useContext(GroupContext)\n  if (context === null) {\n    const err = new Error(`<${component} /> is missing a parent <Switch.Group /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useGroupContext)\n    throw err\n  }\n  return context\n}\n\n// ---\n\nconst DEFAULT_GROUP_TAG = React.Fragment\n\nfunction Group<TTag extends React.ElementType = typeof DEFAULT_GROUP_TAG>(props: Props<TTag>) {\n  const [switchElement, setSwitchElement] = React.useState<HTMLButtonElement | null>(null)\n  const [labelElement, setLabelElement] = React.useState<HTMLLabelElement | null>(null)\n\n  const context = React.useMemo<StateDefinition>(\n    () => ({\n      switch: switchElement,\n      label: labelElement,\n      setSwitch: setSwitchElement,\n      setLabel: setLabelElement,\n    }),\n    [switchElement, setSwitchElement, labelElement, setLabelElement]\n  )\n  return (\n    <GroupContext.Provider value={context}>\n      {render(props, {}, DEFAULT_GROUP_TAG)}\n    </GroupContext.Provider>\n  )\n}\n\n// ---\n\nconst DEFAULT_SWITCH_TAG = 'button'\n\ntype SwitchRenderPropArg = { checked: boolean }\n\ntype SwitchPropsWeControl = 'id' | 'role' | 'tabIndex' | 'aria-checked' | 'onClick' | 'onKeyUp'\n\nexport function Switch<TTag extends React.ElementType = typeof DEFAULT_SWITCH_TAG>(\n  props: Props<\n    TTag,\n    SwitchRenderPropArg,\n    SwitchPropsWeControl | 'checked' | 'onChange' | 'className'\n  > & {\n    checked: boolean\n    onChange(checked: boolean): void\n\n    // Special treatment, can either be a string or a function that resolves to a string\n    className?: ((bag: SwitchRenderPropArg) => string) | string\n  }\n) {\n  const { checked, onChange, className, ...passThroughProps } = props\n  const id = `headlessui-switch-${useId()}`\n  const groupContext = React.useContext(GroupContext)\n\n  const toggle = React.useCallback(() => onChange(!checked), [onChange, checked])\n  const handleClick = React.useCallback(\n    (event: React.MouseEvent) => {\n      event.preventDefault()\n      toggle()\n    },\n    [toggle]\n  )\n  const handleKeyUp = React.useCallback(\n    (event: React.KeyboardEvent<HTMLElement>) => {\n      if (event.key === Keys.Space) {\n        event.preventDefault()\n        toggle()\n      }\n    },\n    [toggle]\n  )\n\n  const propsBag = React.useMemo<SwitchRenderPropArg>(() => ({ checked }), [checked])\n  const propsWeControl = {\n    id,\n    ref: groupContext === null ? undefined : groupContext.setSwitch,\n    role: 'switch',\n    tabIndex: 0,\n    className: resolvePropValue(className, propsBag),\n    'aria-checked': checked,\n    'aria-labelledby': groupContext?.label?.id,\n    onClick: handleClick,\n    onKeyUp: handleKeyUp,\n  }\n\n  return render({ ...passThroughProps, ...propsWeControl }, propsBag, DEFAULT_SWITCH_TAG)\n}\n\n// ---\n\ntype LabelPropsWeControl = 'id' | 'ref' | 'onPointerUp'\n\nconst DEFAULT_LABEL_TAG = 'label'\n\ntype LabelRenderPropArg = {}\n\nfunction Label<TTag extends React.ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  const state = useGroupContext([Switch.name, Label.name].join('.'))\n  const id = `headlessui-switch-label-${useId()}`\n\n  const handlePointerUp = React.useCallback(() => {\n    if (!state.switch) return\n    state.switch.click()\n    state.switch.focus()\n  }, [state.switch])\n\n  const propsWeControl = {\n    ref: state.setLabel,\n    id,\n    onPointerUp: handlePointerUp,\n  }\n  return render({ ...props, ...propsWeControl }, {}, DEFAULT_LABEL_TAG)\n}\n\n// ---\n\nSwitch.Group = Group\nSwitch.Label = Label\n\n// ---\n\nfunction resolvePropValue<TProperty, TBag>(property: TProperty, bag: TBag) {\n  if (property === undefined) return undefined\n  if (typeof property === 'function') return property(bag)\n  return property\n}\n"],"names":["useIsoMorphicEffect","window","React","state","serverHandoffComplete","id","generateId","useId","setId","undefined","useIsInitialRender","initial","current","useIsMounted","mounted","match","value","lookup","returnValue","args","error","Error","Object","keys","map","key","join","captureStackTrace","once","cb","called","disposables","api","requestAnimationFrame","raf","add","cancelAnimationFrame","nextFrame","setTimeout","timer","clearTimeout","push","dispose","splice","forEach","addClasses","node","classes","length","classList","removeClasses","remove","Reason","waitForTransition","done","d","getComputedStyle","transitionDuration","transitionDelay","split","filter","Boolean","v","includes","parseFloat","sort","a","z","resolvedValue","durationMs","delaysMs","Finished","Cancelled","transition","base","from","to","_done","reason","useSplitClasses","className","trim","TransitionContext","TreeStates","useTransitionContext","context","useParentNesting","NestingContext","useNesting","doneRef","transitionableChildren","unregister","childId","idx","indexOf","register","children","TransitionChild","props","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","rest","container","Visible","setState","show","appear","isTransitioning","nesting","Hidden","enterClasses","enterFromClasses","enterToClasses","leaveClasses","leaveFromClasses","leaveToClasses","skip","Provider","as","Component","passthroughProps","ref","Transition","nestingBag","transitionBag","Child","render","bag","tag","passThroughProps","resolvedChildren","Array","isArray","err","mergeEventFunctions","compact","existingProps","functionsToMerge","clone","assign","func","event","defaultPrevented","forwardRefWithAs","component","object","useDisposables","useSyncRefs","refs","Keys","MenuStates","ActionTypes","Focus","calculateActiveItemIndex","focus","items","activeItemIndex","nextActiveIndex","FirstItem","findIndex","item","dataRef","disabled","PreviousItem","slice","reverse","all","NextItem","LastItem","SpecificItem","Nothing","reducers","CloseMenu","menuState","Closed","OpenMenu","Open","GoToItem","action","searchQuery","Search","textValue","startsWith","ClearSearch","RegisterItem","UnregisterItem","nextItems","currentActiveItem","MenuContext","useMenuContext","Menu","name","stateReducer","type","DEFAULT_MENU_TAG","reducerBag","buttonRef","itemsRef","dispatch","handler","contains","target","addEventListener","removeEventListener","propsBag","open","DEFAULT_BUTTON_TAG","Button","focused","setFocused","handleKeyDown","Space","Enter","ArrowDown","preventDefault","ArrowUp","handlePointerUp","handleFocus","handleBlur","propsWeControl","onKeyDown","onFocus","onBlur","onPointerUp","DEFAULT_ITEMS_TAG","Items","isStatic","searchDisposables","document","getElementById","click","Home","PageUp","End","PageDown","Escape","Tab","role","tabIndex","DEFAULT_ITEM_TAG","Item","onClick","active","textContent","toLowerCase","handleClick","handlePointerMove","handlePointerLeave","resolvePropValue","onPointerMove","onPointerLeave","property","useComputed","dependencies","setValue","cbRef","ListboxStates","calculateActiveOptionIndex","options","activeOptionIndex","First","option","Previous","Next","Last","Specific","CloseListbox","listboxState","OpenListbox","GoToOption","RegisterOption","UnregisterOption","nextOptions","currentActiveOption","ListboxContext","useListboxContext","Listbox","DEFAULT_LISTBOX_TAG","onChange","propsRef","labelRef","optionsRef","labelledby","DEFAULT_LABEL_TAG","Label","DEFAULT_OPTIONS_TAG","Options","DEFAULT_OPTION_TAG","Option","selected","select","scrollIntoView","block","GroupContext","useGroupContext","DEFAULT_GROUP_TAG","Group","switchElement","setSwitchElement","labelElement","setLabelElement","label","setSwitch","setLabel","DEFAULT_SWITCH_TAG","Switch","checked","groupContext","toggle","handleKeyUp","onKeyUp"],"mappings":"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"}